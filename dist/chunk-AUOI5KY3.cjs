'use strict';var chunkLM53EFPZ_cjs=require('./chunk-LM53EFPZ.cjs'),child_process=require('child_process'),l=require('fs'),f=require('net'),w=require('os'),g=require('path');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var l__default=/*#__PURE__*/_interopDefault(l);var f__default=/*#__PURE__*/_interopDefault(f);var w__default=/*#__PURE__*/_interopDefault(w);var g__default=/*#__PURE__*/_interopDefault(g);/* ZuzJS Process Manager */
function o(d){return new Promise((r,t)=>{let n=f__default.default.createConnection(chunkLM53EFPZ_cjs.d()),e="";n.on("connect",()=>{n.write(JSON.stringify(d)+`
`);}),n.on("data",i=>{e+=i.toString();let s=e.split(`
`);e=s.pop()??"";for(let m of s)if(m.trim())try{let a=JSON.parse(m);n.destroy(),a.ok?r(a.data):t(new Error(a.error));}catch(a){n.destroy(),t(a);}}),n.on("error",i=>t(i)),n.setTimeout(1e4,()=>{n.destroy(),t(new Error("IPC timeout"));});})}var u=class{daemonScript;constructor(r){this.daemonScript=r??g__default.default.join(__dirname,"daemon.js");}async isDaemonRunning(){try{return chunkLM53EFPZ_cjs.c.info("[ZPM]","Daemon is Running :?"),await o({cmd:"ping"}),!0}catch{return chunkLM53EFPZ_cjs.c.info("[ZPM]","Daemon is not running."),false}}async ensureDaemon(){if(await this.isDaemonRunning()){chunkLM53EFPZ_cjs.c.info("[ZPM]","Daemon is Running :)");return}console.log("[ZPM] Spawning daemon..."),child_process.spawn(process.execPath,[this.daemonScript],{detached:true,stdio:"ignore"}).unref(),await this.waitForDaemon(8e3);}async killDaemon(){let r=g__default.default.join(w__default.default.tmpdir(),"zuzjs-pm.pid");if(!l__default.default.existsSync(r))throw new Error("Daemon PID file not found \u2013 is the daemon running?");let t=Number(l__default.default.readFileSync(r,"utf8").trim());try{process.kill(t,"SIGTERM"),console.log(`[ZPM] Sent SIGTERM to daemon (PID ${t})`);}catch(n){throw new Error(`Failed to kill daemon: ${n.message}`)}}async start(r){return o({cmd:"start",name:r.name,config:r})}async stop(r){return o({cmd:"stop",name:r})}async restart(r){return o({cmd:"restart",name:r})}async delete(r){return o({cmd:"delete",name:r})}async stats(r){return o({cmd:"stats",name:r})}async list(){return o({cmd:"list"})}waitForDaemon(r){let t=Date.now(),n=200;return new Promise((e,i)=>{let s=()=>{this.isDaemonRunning().then(m=>{if(m)return e();if(Date.now()-t>r)return i(new Error("Daemon did not start in time"));setTimeout(s,n);});};setTimeout(s,n);})}},R=new u;exports.a=u;exports.b=R;