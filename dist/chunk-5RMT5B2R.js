import f from'path';import {fileURLToPath}from'url';import I from'net';import l from'os';import d from'fs';var k=()=>fileURLToPath(import.meta.url),S=()=>f.dirname(k()),c=S();var w=(o=>(o.Fork="fork",o.Cluster="cluster",o))(w||{}),P=(s=>(s.Stopped="stopped",s.Starting="starting",s.Running="running",s.Stopping="stopping",s.Crashed="crashed",s.Errored="errored",s))(P||{});var x={info:"\x1B[36m",warn:"\x1B[33m",error:"\x1B[31m",debug:"\x1B[90m",success:"\x1B[32m"},h="\x1B[0m",v="\x1B[1m";function y(){return new Date().toISOString()}function i(e,r,...o){let n=x[e],t=`${v}${n}[ZPM/${r.toUpperCase()}]${h} ${y()}`;console[e==="success"?"log":e](`${t} \u2192`,...o);}var a={info:(e,...r)=>i("info",e,...r),warn:(e,...r)=>i("warn",e,...r),error:(e,...r)=>i("error",e,...r),debug:(e,...r)=>i("debug",e,...r),success:(e,...r)=>i("success",e,...r)};function L(){return l.platform()==="win32"?f.join("\\\\.\\pipe","zuzjs-pm"):f.join(l.tmpdir(),"zuzjs-pm.sock")}function U(e){let r=L();d.existsSync(r)&&d.unlinkSync(r);let o=I.createServer(n=>{let t="";n.on("data",m=>{t+=m.toString();let s=t.split(`
`);t=s.pop()??"";for(let g of s)g.trim()&&R(e,n,g);}),n.on("error",m=>{a.error("IPC","Socket error:",m.message);});});return o.listen(r,()=>{a.success("IPC",`Listening on ${r}`);}),o.on("error",n=>{a.error("IPC","Server error:",n);}),o}async function R(e,r,o){let n;try{n=JSON.parse(o);}catch{u(r,{ok:false,error:"Invalid JSON"});return}try{let t=null;switch(n.cmd){case "ping":t="pong";break;case "start":await e.start(n.config),t=`Started "${n.name}"`;break;case "stop":await e.stop(n.name),t=`Stopped "${n.name}"`;break;case "restart":await e.restart(n.name),t=`Restarted "${n.name}"`;break;case "delete":await e.delete(n.name),t=`Deleted "${n.name}"`;break;case "stats":t=await e.getStats(n.name);break;case "list":t=e.list();break;default:throw new Error(`Unknown command: ${n.cmd}`)}u(r,{ok:!0,data:t});}catch(t){u(r,{ok:false,error:String(t.message??t)});}}function u(e,r){e.writable&&e.write(JSON.stringify(r)+`
`);}export{c as a,w as b,P as c,a as d,L as e,U as f};