import {d as d$2}from'./chunk-IIKD4V5E.js';import {d as d$1,f as f$1}from'./chunk-5RMT5B2R.js';import e from'fs';import m from'os';import p from'path';var i=p.join(m.tmpdir(),"zuzjs-pm.pid");function d(){e.writeFileSync(i,String(process.pid));}function u(){e.existsSync(i)&&e.unlinkSync(i);}var f=p.join(m.tmpdir(),"zuzjs-pm.snapshot.json");function l(o){try{let r=o.list();e.writeFileSync(f,JSON.stringify(r,null,2));}catch{}}async function S(){d$1.success("daemon",`Booting ZPM daemon (PID ${process.pid})`),d();let o=new d$2,r=f$1(o);async function t(s){d$1.info("daemon",`Received ${s} \u2013 shutting down\u2026`),l(o),r.close(),await o.stopAll(),u(),process.exit(0);}process.on("SIGINT",()=>t("SIGINT")),process.on("SIGTERM",()=>t("SIGTERM")),process.on("uncaughtException",s=>d$1.error("daemon","Uncaught exception:",s)),process.on("unhandledRejection",s=>d$1.error("daemon","Unhandled rejection:",s)),d$1.success("daemon","Ready \u2013 waiting for IPC commands.");}S().catch(o=>{d$1.error("daemon","Fatal startup error:",o),process.exit(1);});