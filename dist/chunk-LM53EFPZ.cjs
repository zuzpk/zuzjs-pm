'use strict';var P=require('net'),p=require('os'),l=require('fs'),d=require('path');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var P__default=/*#__PURE__*/_interopDefault(P);var p__default=/*#__PURE__*/_interopDefault(p);var l__default=/*#__PURE__*/_interopDefault(l);var d__default=/*#__PURE__*/_interopDefault(d);/* ZuzJS Process Manager */
var f=(o=>(o.Fork="fork",o.Cluster="cluster",o))(f||{}),b=(s=>(s.Stopped="stopped",s.Starting="starting",s.Running="running",s.Stopping="stopping",s.Crashed="crashed",s.Errored="errored",s))(b||{});var C={info:"\x1B[36m",warn:"\x1B[33m",error:"\x1B[31m",debug:"\x1B[90m",success:"\x1B[32m"},k="\x1B[0m",S="\x1B[1m";function w(){return new Date().toISOString()}function i(e,r,...o){let n=C[e],t=`${S}${n}[ZPM/${r.toUpperCase()}]${k} ${w()}`;console[e==="success"?"log":e](`${t} \u2192`,...o);}var a={info:(e,...r)=>i("info",e,...r),warn:(e,...r)=>i("warn",e,...r),error:(e,...r)=>i("error",e,...r),debug:(e,...r)=>i("debug",e,...r),success:(e,...r)=>i("success",e,...r)};function x(){return p__default.default.platform()==="win32"?d__default.default.join("\\\\.\\pipe","zuzjs-pm"):d__default.default.join(p__default.default.tmpdir(),"zuzjs-pm.sock")}function J(e){let r=x();l__default.default.existsSync(r)&&l__default.default.unlinkSync(r);let o=P__default.default.createServer(n=>{let t="";n.on("data",m=>{t+=m.toString();let s=t.split(`
`);t=s.pop()??"";for(let u of s)u.trim()&&h(e,n,u);}),n.on("error",m=>{a.error("IPC","Socket error:",m.message);});});return o.listen(r,()=>{a.success("IPC",`Listening on ${r}`);}),o.on("error",n=>{a.error("IPC","Server error:",n);}),o}async function h(e,r,o){let n;try{n=JSON.parse(o);}catch{c(r,{ok:false,error:"Invalid JSON"});return}try{let t=null;switch(n.cmd){case "ping":t="pong";break;case "start":await e.start(n.config),t=`Started "${n.name}"`;break;case "stop":await e.stop(n.name),t=`Stopped "${n.name}"`;break;case "restart":await e.restart(n.name),t=`Restarted "${n.name}"`;break;case "delete":await e.delete(n.name),t=`Deleted "${n.name}"`;break;case "stats":t=await e.getStats(n.name);break;case "list":t=e.list();break;default:throw new Error(`Unknown command: ${n.cmd}`)}c(r,{ok:!0,data:t});}catch(t){c(r,{ok:false,error:String(t.message??t)});}}function c(e,r){e.writable&&e.write(JSON.stringify(r)+`
`);}exports.a=f;exports.b=b;exports.c=a;exports.d=x;exports.e=J;